# VeriRegime - zkMLè½¬æ¢æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°†è®­ç»ƒå¥½çš„MLP Studentæ¨¡å‹è½¬æ¢ä¸ºé›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶

- âœ… å·²å®ŒæˆCNN Teacherè®­ç»ƒ
- âœ… å·²å®ŒæˆçŸ¥è¯†è’¸é¦è®­ç»ƒ
- âœ… MLP Studentæ¨¡å‹å·²ä¿å­˜åœ¨ `results/checkpoints/best_student.pth`

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: å®‰è£…EZKLç¯å¢ƒ

```bash
cd /Users/lambertlin/Projects/VeriRegime
./scripts/setup_ezkl.sh
```

**é¢„è®¡æ—¶é—´**: 5-10åˆ†é’Ÿï¼ˆé¦–æ¬¡å®‰è£…ï¼‰

**è¯¥è„šæœ¬ä¼š**ï¼š
- æ£€æŸ¥å¹¶å®‰è£…Rust
- å®‰è£…EZKLå‘½ä»¤è¡Œå·¥å…·
- å®‰è£…Pythonä¾èµ–ï¼ˆonnx, onnxruntimeï¼‰
- åˆ›å»ºå¿…è¦çš„è¾“å‡ºç›®å½•

### æ­¥éª¤2: å¯¼å‡ºONNXæ¨¡å‹

åœ¨Jupyter Labä¸­æ‰“å¼€å¹¶è¿è¡Œï¼š

```bash
notebooks/export_onnx.ipynb
```

**è¯¥Notebookä¼š**ï¼š
1. åŠ è½½è®­ç»ƒå¥½çš„MLP Student
2. å¯¼å‡ºä¸ºONNXæ ¼å¼
3. éªŒè¯ONNXæ¨¡å‹æ­£ç¡®æ€§
4. ä¿å­˜æ¨¡å‹å…ƒæ•°æ®

**è¾“å‡º**ï¼š
- `results/onnx/student_model.onnx` - ONNXæ¨¡å‹æ–‡ä»¶
- `results/onnx/model_metadata.json` - æ¨¡å‹å…ƒæ•°æ®

**é¢„è®¡æ—¶é—´**: 2-3åˆ†é’Ÿ

### æ­¥éª¤3: ç”ŸæˆZKè¯æ˜

#### æ–¹æ³•A: ä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
./scripts/zkml_generate_proof.sh
```

**è¯¥è„šæœ¬ä¼šè‡ªåŠ¨**ï¼š
1. ç”ŸæˆEZKLè®¾ç½®
2. æ ¡å‡†ç”µè·¯å‚æ•°
3. ç¼–è¯‘ZKç”µè·¯
4. ç”Ÿæˆè¯æ˜å¯†é’¥å’ŒéªŒè¯å¯†é’¥
5. ç”Ÿæˆè§è¯ï¼ˆWitnessï¼‰
6. ç”ŸæˆZKè¯æ˜
7. éªŒè¯è¯æ˜

**é¢„è®¡æ—¶é—´**: 
- é¦–æ¬¡è¿è¡Œï¼š5-15åˆ†é’Ÿï¼ˆåŒ…æ‹¬å¯†é’¥ç”Ÿæˆï¼‰
- åç»­è¿è¡Œï¼š2-8ç§’ï¼ˆä»…ç”Ÿæˆè¯æ˜ï¼‰

#### æ–¹æ³•B: ä½¿ç”¨Jupyter Notebook

```bash
notebooks/zkml_test.ipynb
```

æ›´è¯¦ç»†çš„äº¤äº’å¼ä½“éªŒï¼Œå¯ä»¥æŸ¥çœ‹æ¯ä¸€æ­¥çš„è¾“å‡ºã€‚

---

## ğŸ“Š é¢„æœŸæ€§èƒ½

æ ¹æ®æˆ‘ä»¬çš„MLPæ¶æ„ï¼ˆ471Kå‚æ•°ï¼‰ï¼Œé¢„æœŸæ€§èƒ½ï¼š

| æŒ‡æ ‡ | é¢„æœŸå€¼ | è¯´æ˜ |
|-----|-------|------|
| **ç”µè·¯çº¦æŸæ•°** | ~500K | constraintsæ•°é‡ |
| **è¯æ˜ç”Ÿæˆæ—¶é—´** | 5-10ç§’ | é¦–æ¬¡è¿è¡Œå |
| **éªŒè¯æ—¶é—´** | 50-200ms | é“¾ä¸ŠéªŒè¯ |
| **è¯æ˜å¤§å°** | ~128-256KB | å–å†³äºç”µè·¯å¤æ‚åº¦ |
| **Gasæˆæœ¬ï¼ˆé¢„ä¼°ï¼‰** | ~300-600K | ä»¥å¤ªåŠä¸»ç½‘ |

---

## ğŸ”§ é…ç½®è¯´æ˜

### EZKLè®¾ç½®å‚æ•°

åœ¨ `results/zkml/settings/settings.json` ä¸­å¯ä»¥è°ƒæ•´ï¼š

```json
{
  "run_args": {
    "tolerance": {
      "val": 0.0,
      "scale": 1
    },
    "input_scale": 7,
    "param_scale": 7,
    "scale_rebase_multiplier": 10,
    "lookup_range": [-32768, 32768],
    "logrows": 17,
    "num_inner_cols": 2,
    "variables": [["batch_size", 1]],
    "input_visibility": "public",
    "output_visibility": "public",
    "param_visibility": "fixed"
  }
}
```

**å…³é”®å‚æ•°**ï¼š
- `input_scale` / `param_scale`: é‡åŒ–ç²¾åº¦ï¼ˆè¶Šå¤§è¶Šç²¾ç¡®ï¼Œä½†ç”µè·¯æ›´å¤§ï¼‰
- `logrows`: ç”µè·¯å¤§å°ï¼ˆ2^logrows = çº¦æŸæ•°ä¸Šé™ï¼‰
- `lookup_range`: æŸ¥æ‰¾è¡¨èŒƒå›´
- `input_visibility`: è¾“å…¥å¯è§æ€§ï¼ˆpublic/privateï¼‰

### è¾“å…¥æ•°æ®æ ¼å¼

è¾“å…¥æ•°æ®ä¿å­˜åœ¨ `results/zkml/input.json`ï¼š

```json
{
  "input_data": [
    [
      [
        [0.123, -0.456, ...],  // 240ä¸ªæ—¶é—´æ­¥
        ...
      ]
    ]
  ]
}
```

å½¢çŠ¶: `[batch_size=1, seq_length=240, features=7]`

---

## ğŸ“ è¾“å‡ºæ–‡ä»¶è¯´æ˜

```
results/zkml/
â”œâ”€â”€ settings/
â”‚   â””â”€â”€ settings.json           # EZKLç”µè·¯é…ç½®
â”œâ”€â”€ compiled/
â”‚   â”œâ”€â”€ network.ezkl           # ç¼–è¯‘åçš„ZKç”µè·¯
â”‚   â”œâ”€â”€ pk.key                 # è¯æ˜å¯†é’¥ï¼ˆProving Keyï¼‰
â”‚   â””â”€â”€ vk.key                 # éªŒè¯å¯†é’¥ï¼ˆVerification Keyï¼‰
â”œâ”€â”€ proof/
â”‚   â”œâ”€â”€ proof.json             # ZKè¯æ˜
â”‚   â””â”€â”€ witness.json           # è§è¯æ•°æ®
â””â”€â”€ input.json                 # è¾“å…¥æ•°æ®
```

**æ–‡ä»¶ç”¨é€”**ï¼š
- `network.ezkl`: ç¼–è¯‘åçš„ç”µè·¯ï¼Œç”¨äºç”Ÿæˆè¯æ˜
- `pk.key`: è¯æ˜è€…ç”¨äºç”Ÿæˆè¯æ˜ï¼ˆè¾ƒå¤§ï¼Œ~å‡ MBï¼‰
- `vk.key`: éªŒè¯è€…ç”¨äºéªŒè¯è¯æ˜ï¼ˆè¾ƒå°ï¼Œ~å‡ KBï¼‰
- `proof.json`: ZKè¯æ˜ï¼Œå¯å‘å¸ƒåˆ°é“¾ä¸Š
- `witness.json`: ä¸­é—´è®¡ç®—ç»“æœ

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æœ¬åœ°éªŒè¯

```bash
ezkl verify \
    --proof-path results/zkml/proof/proof.json \
    --vk-path results/zkml/compiled/vk.key \
    --settings-path results/zkml/settings/settings.json
```

### 2. åœ¨æµ‹è¯•æ•°æ®ä¸ŠéªŒè¯

è¿è¡Œ `notebooks/zkml_test.ipynb` ä¸­çš„å®Œæ•´æµ‹è¯•æµç¨‹ã€‚

### 3. æ€§èƒ½åŸºå‡†æµ‹è¯•

```bash
# å¤šæ¬¡è¿è¡Œæµ‹è¯•å¹³å‡æ—¶é—´
for i in {1..5}; do
    echo "æµ‹è¯• $i/5"
    time ./scripts/zkml_generate_proof.sh
done
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: EZKLå®‰è£…å¤±è´¥

**A**: ç¡®ä¿å·²å®‰è£…Rustï¼š
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env
```

### Q2: ç”µè·¯ç¼–è¯‘Out of Memory

**A**: å‡å°æ¨¡å‹è¾“å…¥æˆ–é™ä½é‡åŒ–ç²¾åº¦ï¼š
- ä¿®æ”¹ `input_scale` ä»7é™åˆ°6
- å‡å°‘ `seq_length`ï¼ˆå¦‚ä»240é™åˆ°120ï¼‰

### Q3: è¯æ˜ç”Ÿæˆæ—¶é—´è¿‡é•¿

**A**: è¿™æ˜¯æ­£å¸¸çš„ï¼Œé¦–æ¬¡ç”Ÿæˆéœ€è¦ï¼š
- å¯†é’¥ç”Ÿæˆï¼š2-5åˆ†é’Ÿ
- è¯æ˜ç”Ÿæˆï¼š5-10ç§’

åç»­åªéœ€5-10ç§’ã€‚

### Q4: ONNXæ¨¡å‹å¯¼å‡ºå¤±è´¥

**A**: æ£€æŸ¥PyTorchç‰ˆæœ¬å’Œæ¨¡å‹ç»“æ„ï¼š
```python
# ç¡®ä¿æ¨¡å‹åœ¨CPUä¸Š
model = model.cpu()
model.eval()
```

---

## ğŸ“ˆ ä¼˜åŒ–å»ºè®®

### 1. å‡å°ç”µè·¯å¤§å°

**æ–¹æ³•**ï¼š
- é™ä½é‡åŒ–ç²¾åº¦ï¼š`input_scale = 6`
- å‡å°‘éšè—å±‚ç»´åº¦ï¼š`[128, 32]` è€Œä¸æ˜¯ `[256, 128, 64]`
- ä½¿ç”¨æ›´çŸ­çš„åºåˆ—é•¿åº¦

### 2. æå‡è¯æ˜é€Ÿåº¦

**æ–¹æ³•**ï¼š
- ä½¿ç”¨GPUåŠ é€Ÿï¼ˆéœ€CUDAæ”¯æŒï¼‰
- ä¼˜åŒ–æŸ¥æ‰¾è¡¨èŒƒå›´
- æ‰¹é‡ç”Ÿæˆè¯æ˜

### 3. é™ä½Gasæˆæœ¬

**æ–¹æ³•**ï¼š
- ä½¿ç”¨æ›´å°çš„æ¨¡å‹
- é™ä½è¯æ˜ç²¾åº¦
- è€ƒè™‘Layer 2è§£å†³æ–¹æ¡ˆï¼ˆzkSync, StarkNetï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®ŒæˆzkMLè½¬æ¢åï¼š

1. **æ€§èƒ½åˆ†æ**ï¼š
   - è®°å½•è¯æ˜ç”Ÿæˆæ—¶é—´
   - è¯„ä¼°Gasæˆæœ¬
   - å¯¹æ¯”ä¸åŒå‚æ•°é…ç½®

2. **é›†æˆåˆ°åº”ç”¨**ï¼š
   - åˆ›å»ºå‰ç«¯æ¥å£
   - éƒ¨ç½²éªŒè¯åˆçº¦åˆ°æµ‹è¯•ç½‘
   - æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹

3. **è¿›ä¸€æ­¥ä¼˜åŒ–**ï¼š
   - å°è¯•æ›´å°çš„MLPæ¶æ„
   - å®ç°å¤šé¡¹å¼æ¿€æ´»å‡½æ•°æ›¿æ¢
   - æ¢ç´¢é‡åŒ–æ„ŸçŸ¥è®­ç»ƒ

---

## ğŸ“š å‚è€ƒèµ„æº

- [EZKLå®˜æ–¹æ–‡æ¡£](https://docs.ezkl.xyz/)
- [EZKL GitHub](https://github.com/zkonduit/ezkl)
- [é›¶çŸ¥è¯†è¯æ˜å…¥é—¨](https://zkhack.dev/)
- [Halo2æ•™ç¨‹](https://zcash.github.io/halo2/)

---

**ç¥æ‚¨zkMLè½¬æ¢é¡ºåˆ©ï¼** ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ `PROJECT_STATUS.md` æˆ–åˆ›å»ºissueã€‚

