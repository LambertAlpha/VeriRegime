# VeriRegime 模型优化分析报告

## 📊 当前模型表现

### 简化CNN模型 (train_cnn_simple.py)
- **测试准确率**: 39.79%
- **测试F1**: 0.3806
- **目标**: Accuracy≥60%, F1≥0.60
- **差距**: -20.21% 准确率, -0.22 F1

### 分类报告
```
              precision    recall  f1-score   support
SELL (0)        0.3317    0.2193    0.2640     39328
HOLD (1)        0.6387    0.3727    0.4708     66233
BUY  (2)        0.3049    0.6120    0.4070     40616
```

**观察**: 
- HOLD类精确率最高(63.87%)但召回率低(37.27%)
- BUY类召回率高(61.20%)但精确率低(30.49%)
- SELL类表现最差(F1=0.26)

---

## 🔍 根本问题诊断

### 1. 标签高度自相关性
```
标签转移矩阵 (当前状态 → 下一状态):
         SELL    HOLD     BUY
SELL   89.51%  10.42%   0.07%  ← 89%保持SELL
HOLD    4.09%  91.65%   4.27%  ← 91%保持HOLD
BUY     0.06%   9.97%  89.97%  ← 90%保持BUY

连续相同标签平均长度: 10.9分钟
```

**关键发现**: 
- 标签有89-91%概率保持不变
- 如果模型知道"当前标签"，简单预测"不变"就能达到90%准确率
- **但当前模型输入中没有标签历史信息！**

### 2. 特征工程不足

**当前使用特征** (仅7个):
- `ema_5, ema_10, ema_20` - 指数移动平均
- `rsi` - 相对强弱指标
- `macd` - 移动平均收敛发散
- `volume_ma_5, volume_ma_10` - 成交量均线

**数据集可用但未使用的特征**:
- `open, high, low, close` - OHLC价格
- `volume` - 原始成交量
- `future_return_1h` - 未来1小时收益率

**缺失的关键特征**:
- 价格变化率 (returns)
- 波动率 (volatility)
- 价格范围 (high-low)
- 成交量变化率
- 价格动量
- 布林带
- ATR (真实波幅)

### 3. 标签定义问题

**当前**: ±0.2% (1分钟收益率)
- 标签变化频率: 9.53%
- 可能包含大量噪音（1分钟波动）

**问题**: 
- 1分钟太短，容易受随机波动影响
- 模型难以从噪声中学习真实趋势

### 4. 模型架构问题

**当前**: 1D CNN
- 适合空间特征提取
- 对时序依赖建模能力有限

**更好选择**: 
- LSTM/GRU: 专门处理时序依赖
- Transformer: 捕捉长期依赖

---

## 🎯 优化方案

### 优先级1: 增强特征工程 ⭐⭐⭐

#### 方案A: 添加价格和成交量特征
```python
# 价格特征
- return_1m, return_5m, return_15m  # 多时间尺度收益率
- volatility_10m, volatility_30m    # 滚动波动率
- price_range = (high - low) / close  # 价格范围
- price_position = (close - low) / (high - low)  # 价格位置

# 成交量特征
- volume_change_1m, volume_change_5m  # 成交量变化
- volume_ratio = volume / volume_ma_10  # 成交量相对比率

# 技术指标
- bollinger_upper, bollinger_lower  # 布林带
- atr_14  # 真实波幅
- obv  # 能量潮
```

**预期改进**: +5-10% F1

---

### 优先级2: 改进标签策略 ⭐⭐⭐

#### 方案B1: 使用更长时间窗口
```python
# 当前: 1分钟收益率 ± 0.2%
# 改进: 5分钟收益率 ± 0.5%
# 或: 15分钟收益率 ± 1.0%
```

**优点**: 
- 减少短期噪音
- 更符合实际交易决策时间
- 标签更稳定

**预期改进**: +10-15% F1

#### 方案B2: 多标签/连续值预测
```python
# 不预测离散类别，改为预测连续收益率
# 然后根据预测值做决策
```

---

### 优先级3: 添加序列/状态特征 ⭐⭐

#### 方案C: 添加标签历史
```python
# 在输入特征中加入:
- prev_label_1, prev_label_2, prev_label_3  # 前3个标签
- label_duration  # 当前标签持续时间
```

**原理**: 利用"标签高度自相关"这个特性

**预期改进**: +15-25% 准确率 (可能达到目标!)

---

### 优先级4: 尝试LSTM架构 ⭐⭐

#### 方案D: CNN → LSTM
```python
class LSTMRegimeClassifier(nn.Module):
    def __init__(self):
        self.lstm = nn.LSTM(
            input_size=特征数,
            hidden_size=128,
            num_layers=2,
            dropout=0.2,
            batch_first=True
        )
        self.fc = nn.Linear(128, 3)
```

**优点**: 
- 更好地建模时序依赖
- 自然处理序列预测

**预期改进**: +5-10% F1

---

### 优先级5: 数据层面优化 ⭐

#### 方案E1: 数据增强
```python
# 时间窗口随机偏移
# 添加轻微噪声
# 时间序列cutout
```

#### 方案E2: 采样策略
```python
# 过采样SELL类（表现最差）
# 使用focal loss聚焦困难样本
```

---

## 🚀 建议实施顺序

### 阶段1: 快速提升 (预期达到F1 0.50+)
1. **添加标签历史特征** (方案C) - 最快见效
2. **改用5分钟标签** (方案B1) - 减少噪音

### 阶段2: 特征增强 (预期达到F1 0.55+)  
3. **添加10-15个新特征** (方案A)
4. **特征重要性分析**，移除无用特征

### 阶段3: 架构优化 (预期达到F1 0.60+)
5. **尝试LSTM** (方案D)
6. **集成学习**: CNN + LSTM

---

## 📈 预期最终效果

如果实施以上方案:
- **保守估计**: Accuracy 55%, F1 0.52
- **乐观估计**: Accuracy 65%, F1 0.62
- **关键**: 方案C (标签历史) 最重要！

---

## ⚠️ 注意事项

1. **数据泄露风险**: 添加标签历史时注意不要泄露未来信息
2. **过拟合风险**: 特征太多容易过拟合，需要正则化
3. **训练时间**: LSTM比CNN慢2-3倍
4. **标签质量**: 如果标签本身有问题，再好的模型也无济于事

---

生成时间: 2025-11-09
模型版本: SimpleCNNTeacher
数据: BTC/USDT 1分钟 (2022-2024)

