# VeriRegime

**é€šè¿‡çŸ¥è¯†è’¸é¦å°†é«˜æ€§èƒ½CNNä¼˜åŒ–ä¸ºzkMLå‹å¥½çš„MLPç”¨äºåŠ å¯†è´§å¸æ³¢åŠ¨ç‡é¢„æµ‹**

[![Python 3.12](https://img.shields.io/badge/python-3.12.12-blue.svg)](https://www.python.org/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.9.1-red.svg)](https://pytorch.org/)
[![MPS](https://img.shields.io/badge/GPU-MPS-green.svg)](https://developer.apple.com/metal/)

---

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

VeriRegimeç ”ç©¶å¦‚ä½•å°†é«˜æ€§èƒ½CNNæ¨¡å‹è’¸é¦ä¸ºzkMLå‹å¥½çš„MLPæ¨¡å‹ï¼Œç”¨äº**4å°æ—¶æ³¢åŠ¨ç‡é¢„æµ‹**å’Œ**DeFié£é™©ç®¡ç†**ã€‚

### ä»»åŠ¡å®šä¹‰

**é¢„æµ‹ç›®æ ‡**: æœªæ¥4å°æ—¶çš„BTCæ³¢åŠ¨ç‡æ°´å¹³ï¼ˆä½/é«˜ï¼‰  
**æ³¢åŠ¨ç‡é˜ˆå€¼**: 0.05% (å¹³è¡¡åˆ†å¸ƒï¼Œè®­ç»ƒç¨³å®š)  
**æ ‡ç­¾åˆ†å¸ƒ**: ä½æ³¢åŠ¨ ~50%, é«˜æ³¢åŠ¨ ~50%

### ç ”ç©¶åŠ¨æœº

DeFiåè®®ï¼ˆå€Ÿè´·ã€æœŸæƒã€AMMï¼‰éœ€è¦åŠ¨æ€è°ƒæ•´é£é™©å‚æ•°ï¼Œ4å°æ—¶æ³¢åŠ¨ç‡é¢„æµ‹å¯ä»¥ï¼š
- **å€Ÿè´·åè®®**: é«˜æ³¢åŠ¨æ—¶æé«˜æŠµæŠ¼ç‡ï¼Œé™ä½æ¸…ç®—é£é™©
- **æœŸæƒå®šä»·**: æ³¢åŠ¨ç‡æ˜¯Black-Scholesæ¨¡å‹çš„æ ¸å¿ƒè¾“å…¥
- **AMMåšå¸‚**: é«˜æ³¢åŠ¨æ—¶æé«˜äº¤æ˜“æ‰‹ç»­è´¹ä¿æŠ¤LP

**zkMLä¼˜åŠ¿**ï¼š
âœ… é“¾ä¸Šå¯éªŒè¯çš„AIæ¨ç†  
âœ… å»ä¸­å¿ƒåŒ–é£é™©è¯„ä¼°  
âœ… 4å°æ—¶æ›´æ–°å‘¨æœŸé€‚åˆDeFi

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
VeriRegime/
â”œâ”€â”€ train/                  â­ æ¨¡å—åŒ–è®­ç»ƒç»„ä»¶
â”‚   â”œâ”€â”€ models.py          # CNN Teacher + MLP Student
â”‚   â”œâ”€â”€ dataset.py         # æ•°æ®åŠ è½½å™¨
â”‚   â”œâ”€â”€ trainer.py         # CNNè®­ç»ƒå™¨
â”‚   â””â”€â”€ distillation.py    # çŸ¥è¯†è’¸é¦è®­ç»ƒå™¨
â”‚
â”œâ”€â”€ notebooks/              â­ è®­ç»ƒnotebooks
â”‚   â”œâ”€â”€ train_volatility.ipynb     # 4hæ³¢åŠ¨ç‡CNNè®­ç»ƒ
â”‚   â””â”€â”€ train_distillation.ipynb  # çŸ¥è¯†è’¸é¦MLPè®­ç»ƒ
â”‚
â”œâ”€â”€ results/                â­ è®­ç»ƒç»“æœ
â”‚   â”œâ”€â”€ checkpoints/       # æ¨¡å‹checkpoint
â”‚   â”œâ”€â”€ figures/           # å¯è§†åŒ–å›¾è¡¨
â”‚   â””â”€â”€ logs/              # è®­ç»ƒæ—¥å¿—
â”‚
â”œâ”€â”€ scripts/                # æ•°æ®å¤„ç†è„šæœ¬
â”‚   â”œâ”€â”€ data_collection.py      # æ•°æ®æ”¶é›†
â”‚   â”œâ”€â”€ relabel_volatility.py   # 4hæ³¢åŠ¨ç‡æ ‡æ³¨
â”‚   â”œâ”€â”€ data_split.py           # æ•°æ®åˆ†å‰²
â”‚   â””â”€â”€ feature_engineering_v2.py
â”‚
â””â”€â”€ data/                   # æ•°æ®æ–‡ä»¶
    â”œâ”€â”€ btc_usdt_1m_volatility_4h.csv  # å®Œæ•´æ ‡æ³¨æ•°æ®
    â”œâ”€â”€ train.csv
    â”œâ”€â”€ val.csv
    â””â”€â”€ test.csv
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

```bash
# ä½¿ç”¨å·²æœ‰çš„conda mlç¯å¢ƒ
conda activate ml

# å¦‚éœ€å®‰è£…é¢å¤–ä¾èµ–
pip install -r requirements.txt
```

### 2. è®­ç»ƒCNN Teacherï¼ˆæ³¢åŠ¨ç‡é¢„æµ‹ï¼‰

```bash
# ç¡®ä¿åœ¨mlç¯å¢ƒä¸­
conda activate ml

# å¯åŠ¨Jupyter
jupyter lab

# æ‰“å¼€ notebooks/train_volatility.ipynb
# æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰cell
```

**é¢„æœŸç»“æœ**ï¼š
- å‡†ç¡®ç‡: ~74% âœ… (ç›®æ ‡65%)
- F1åˆ†æ•°: ~0.74 âœ… (ç›®æ ‡0.63)
- æ¨¡å‹ä¿å­˜: `results/checkpoints/best_model.pth`

### 3. çŸ¥è¯†è’¸é¦MLP Studentï¼ˆzkMLä¼˜åŒ–ï¼‰

```bash
# ç»§ç»­åœ¨mlç¯å¢ƒä¸­
# æ‰“å¼€ notebooks/train_distillation.ipynb
# æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰cell
```

**é¢„æœŸç»“æœ**ï¼š
- Studentå‡†ç¡®ç‡: â‰¥63% (Teacherçš„85%)
- ç†æƒ³å‡†ç¡®ç‡: â‰¥67% (Teacherçš„90%)
- å‚æ•°å‹ç¼©: ~85% (36k â†’ 5k)
- æ¨¡å‹ä¿å­˜: `results/checkpoints/best_student.pth`

### 3. å…³é”®é…ç½®

åœ¨notebookä¸­å¯è°ƒæ•´ï¼š

```python
SEQ_LENGTH = 240  # 4å°æ—¶çª—å£
BATCH_SIZE = 512
EPOCHS = 50
LR = 1e-3
DROPOUT = 0.3  # éœ€ä¼ ç»™æ¨¡å‹
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡

- **æ€»æ ·æœ¬**: 973,351
- **è®­ç»ƒé›†**: 681,345 (70%)
  - ä½æ³¢åŠ¨: 366,095 (53.7%)
  - é«˜æ³¢åŠ¨: 315,250 (46.3%)
- **éªŒè¯é›†**: 146,003 (15%)
  - ä½æ³¢åŠ¨: 62,540 (42.8%)
  - é«˜æ³¢åŠ¨: 83,463 (57.2%)
- **æµ‹è¯•é›†**: 146,003 (15%)
  - ä½æ³¢åŠ¨: 59,604 (40.8%)
  - é«˜æ³¢åŠ¨: 86,399 (59.2%)
- **æ³¢åŠ¨ç‡é˜ˆå€¼**: 0.05%
- **ç‰¹å¾**: 7ä¸ªæŠ€æœ¯æŒ‡æ ‡ï¼ˆEMA, RSI, MACD, VolumeMAï¼‰
- **æ—¶é—´çª—å£**: 240åˆ†é’Ÿï¼ˆ4å°æ—¶ï¼‰

---

## ğŸ¯ æ€§èƒ½ç›®æ ‡

| æŒ‡æ ‡ | æœ€ä½ç›®æ ‡ | é¢„æœŸç›®æ ‡ | ç†æƒ³ç›®æ ‡ |
|------|---------|---------|---------|
| CNNå‡†ç¡®ç‡ | 60% | 65% | 70% |
| CNN F1-score | 0.58 | 0.63 | 0.68 |
| MLPå‡†ç¡®ç‡ä¿ç•™ | 80% | 85% | 90% |
| è¯æ˜åŠ é€Ÿ | 5Ã— | 10Ã— | 20-50Ã— |
| å‡†ç¡®ç‡ä¸‹é™ | <8% | <5% | <3% |

**æ³¨**: å¹³è¡¡æ•°æ®é›†ï¼ˆ50:50ï¼‰ï¼ŒéšæœºçŒœæµ‹baselineæ˜¯50%ã€‚

---

## ğŸ“ˆ ç ”ç©¶è·¯çº¿å›¾

```
Week 10: CNN Baselineè®­ç»ƒ                    â† å½“å‰é˜¶æ®µ
  â””â”€ ç›®æ ‡: å‡†ç¡®ç‡ â‰¥ 90%

Week 11: MLPè’¸é¦
  â””â”€ ç›®æ ‡: ä¿ç•™85%+ CNNæ€§èƒ½

Week 12: zkMLä¼˜åŒ–
  â”œâ”€ å¤šé¡¹å¼æ¿€æ´»ï¼ˆå‡å°‘50%çº¦æŸï¼‰
  â””â”€ è‡ªé€‚åº”é‡åŒ–ï¼ˆå†å‡å°‘40%çº¦æŸï¼‰

Week 13: EZKLç¼–è¯‘
  â””â”€ ç›®æ ‡: 10-50Ã—è¯æ˜åŠ é€Ÿ

Week 14-15: åˆ†æä¸æŠ¥å‘Š
```

---

## ğŸ”§ è‡ªå®šä¹‰è®­ç»ƒ

### è°ƒæ•´è¶…å‚æ•°

åœ¨notebookä¸­ä¿®æ”¹é…ç½®cellï¼š

```python
EPOCHS = 100        # å¢åŠ è®­ç»ƒè½®æ•°
LR = 5e-4          # è°ƒæ•´å­¦ä¹ ç‡
BATCH_SIZE = 256   # ä¿®æ”¹æ‰¹æ¬¡å¤§å°
```

### ä¿®æ”¹æ¨¡å‹æ¶æ„

ç¼–è¾‘ `train/models.py`ï¼š

```python
class CNNVolatility(nn.Module):
    def __init__(...):
        # ä¿®æ”¹å·ç§¯å±‚é…ç½®
        self.conv1 = nn.Conv1d(..., kernel_size=7)  # æ”¹kernel size
        # æ·»åŠ æ›´å¤šå±‚
```

### æ·»åŠ æ–°ç‰¹å¾

1. åœ¨ `scripts/feature_engineering_v2.py` ä¸­è®¡ç®—æ–°ç‰¹å¾
2. åœ¨notebookä¸­æ›´æ–° `FEATURE_COLS`
3. è°ƒæ•´æ¨¡å‹ `input_channels` å‚æ•°

---

## ğŸ”¬ å¤„ç†ç±»åˆ«ä¸å¹³è¡¡

å½“å‰æ•°æ®æ˜¯90:10çš„ä¸å¹³è¡¡åˆ†å¸ƒï¼Œè®­ç»ƒå™¨å·²å†…ç½®ï¼š

1. **ç±»åˆ«æƒé‡**: è‡ªåŠ¨è®¡ç®—å¹¶åº”ç”¨åˆ°æŸå¤±å‡½æ•°
2. **Focal Loss**: å¯åœ¨ `train/trainer.py` ä¸­å¯ç”¨
3. **è¯„ä¼°æŒ‡æ ‡**: ä½¿ç”¨F1-scoreè€Œéå‡†ç¡®ç‡ä½œä¸ºä¸»æŒ‡æ ‡

æŸ¥çœ‹æ··æ·†çŸ©é˜µé‡ç‚¹å…³æ³¨ï¼š
- **é«˜æ³¢åŠ¨å¬å›ç‡**: æ¨¡å‹è¯†åˆ«åˆ°å¤šå°‘çœŸå®é«˜æ³¢åŠ¨
- **é«˜æ³¢åŠ¨ç²¾ç¡®ç‡**: é¢„æµ‹ä¸ºé«˜æ³¢åŠ¨æ—¶æœ‰å¤šå°‘æ˜¯å¯¹çš„

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### æŸ¥çœ‹ç»“æœ

- **è®­ç»ƒæ—¥å¿—**: `results/logs/`
- **æ¨¡å‹checkpoint**: `results/checkpoints/best_model.pth`
- **å¯è§†åŒ–å›¾è¡¨**: `results/figures/`

### é‡æ–°æ ‡æ³¨æ•°æ®

```bash
# å¦‚éœ€ä¿®æ”¹é˜ˆå€¼ï¼Œç¼–è¾‘ scripts/relabel_volatility.py
# VOLATILITY_THRESHOLD = 0.001  # å½“å‰0.1%

python scripts/relabel_volatility.py
python scripts/data_split.py
```

---

## ğŸ¤ è´¡çŒ®

æœ¬é¡¹ç›®ä¸ºé¦™æ¸¯ä¸­æ–‡å¤§å­¦ï¼ˆæ·±åœ³ï¼‰DDA4220æ·±åº¦å­¦ä¹ è¯¾ç¨‹é¡¹ç›®ã€‚

**å­¦ç”Ÿ**: Lin Boyi (Lambert)  
**å­¦æœŸ**: Fall 2024

---

## ğŸ“„ License

MIT License

---

**æœ€åæ›´æ–°**: 2024-12-01  
**ç‰ˆæœ¬**: 2.0 (4å°æ—¶æ³¢åŠ¨ç‡ç‰ˆæœ¬)
